datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id          String        @id @default(cuid())
  email       String        @unique
  trialEndsAt DateTime?     // 24h trial timestamp
  createdAt   DateTime      @default(now())
  wallets     Wallet[]
  liveSessions LiveSession[]
}

model LiveSession {
  userId     String
  sessionId  String
  duration   Int?           // duration in seconds
  satisfaction Int?         // 0-100 percent
  createdAt  DateTime       @default(now())

  user User @relation(fields: [userId], references: [id])

  @@id([userId, sessionId])
}

model Wallet {
  id           String    @id @default(cuid())
  ownerId      String
  owner        User      @relation(fields: [ownerId], references: [id])
  balance      Decimal   @default("0")
  adminBalance Decimal   @default("0")
  payments     Payment[]
  createdAt    DateTime  @default(now())
}

model Payment {
  id          String        @id @default(cuid())
  amount      Decimal       // payment amount (in currency units)
  provider    String?       // 'razorpay' | 'paypal'
  externalId  String?       // provider order or capture id
  status      PaymentStatus @default(PENDING)
  walletId    String?
  wallet      Wallet?       @relation(fields: [walletId], references: [id])
  webhookPayload Json?
  createdAt   DateTime      @default(now())
}

enum PaymentStatus {
  PENDING
  RELEASED
  PENALIZED
}
