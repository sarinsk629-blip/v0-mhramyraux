generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum PaymentStatus {
  PENDING
  COMPLETED
  RELEASED
  PENALIZED
}

enum EscrowStatus {
  PENDING
  RELEASED
  PENALIZED
}

model User {
  id           String    @id @default(cuid())
  email        String    @unique
  name         String?
  trialEndsAt  DateTime? // 24h trial timestamp
  wallet       Wallet?
  sessions     LiveSession[]
  payments     Payment[]
  createdAt    DateTime  @default(now())
}

model Wallet {
  id              String  @id @default(cuid())
  userId          String  @unique
  balanceInPaise  Int     @default(0) // stored in paise (â‚¹1 = 100)
  user            User    @relation(fields: [userId], references: [id])
}

model AdminBalance {
  id             String @id @default("ADMIN")
  balanceInPaise Int    @default(0)
}

model LiveSession {
  userId      String
  sessionId   String
  duration    Int?    // seconds
  satisfaction Int?   // percent 0-100
  createdAt   DateTime @default(now())

  @@id([userId, sessionId])
  user User @relation(fields: [userId], references: [id])
}

model Payment {
  id               String        @id @default(cuid())
  userId           String
  sessionUserId    String
  sessionId        String
  amountInPaise    Int
  status           PaymentStatus @default(PENDING)
  escrowStatus     EscrowStatus  @default(PENDING)
  provider         String
  providerOrderId  String?
  createdAt        DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
}